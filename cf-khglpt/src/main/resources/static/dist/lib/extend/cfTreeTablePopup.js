layui.define(["tree","layer","table","jquery"],function(b){var a=layui.tree,c=layui.layer,d=layui.table,h=layui.hint(),g=$(document),f=function(i){var j=this;j.config=$.extend({},j.config,i);this.init();return j};f.prototype={selectedItems:[],config:{singleSelection:false,identity:"",searchBarPlaceHolder:"",treeSource:[],treeField:{id:"id",parentId:"pid",name:"name",topId:"0"},tableOptions:null,onSearch:function(j,i){},onOkClick:function(i){}},init:function(){var j=this;var i=j.config;j.popupWrapperId="popup_"+i.identity;j.popUpTreeWrapperId="popupTree"+i.identity;j.popupTableWrapperId="popupTable"+i.identity;j.popupInputId="popupInput"+i.identity;j.searchButtonId="searchButton"+i.identity;j.popupConfirmId="confirm"+i.identity;j.popupCancelId="cancel"+i.identity;$("html").append('<div id="'+j.popupWrapperId+'" style="display: none; height: 100%"><div style="display: flex; justify-content: flex-start; height: 100%"><div id="'+j.popUpTreeWrapperId+'" class="border-style" style="padding: 20px; border-right: 1px solid #d2d2d2;"></div><div style="padding: 20px; width: 100%"><div style="display: flex; width: 100%;"><input autocomplete="off" class="layui-input" id="'+j.popupInputId+'" style="margin-right: 20px" type="text"placeholder="请输入商品编码或名称"><button class="layui-btn" id="'+j.searchButtonId+'">搜索</button></div><table id="'+j.popupTableWrapperId+'" lay-filter="'+j.popupTableWrapperId+'"></table><div style="display: flex; justify-content: flex-end"><button class="layui-btn" id="'+j.popupConfirmId+'">确认</button><button class="layui-btn layui-btn-primary" id="'+j.popupCancelId+'">取消</button></div></div></div></div>');a({elem:"#"+j.popUpTreeWrapperId,nodes:j.convertServerDataToClientTreeSource(JSON.parse(JSON.stringify(i.treeSource)),i.treeField),click:function(k){j.selectedNode=k;i.onSearch(j.selectedNode,$("#"+j.popupInputId).val())}});$("#"+this.searchButtonId).on("click",function(){i.onSearch(j.selectedNode,$("#"+j.popupInputId).val())});$("#"+this.popupConfirmId).on("click",function(){i.onOkClick(j.selectedItems);c.close(c.index)});$("#"+this.popupCancelId).on("click",function(){c.close(c.index)});j.renderTable(i.tableOptions)},renderTable:function(i){var j=this;if(!i){return}if(i.cols&&i.cols.length>0){i.cols[0].splice(0,0,{type:"checkbox",align:"center"})}d.render($.extend({},{elem:"#"+j.popupTableWrapperId},i));d.on("checkbox("+j.popupTableWrapperId+")",function(k){if(k.type=="all"){i.data.map(function(m){var l=j.selectedItems.indexOf(m);if(l>=0){j.selectedItems.splice(l,1)}});if(k.checked){j.selectedItems=j.selectedItems.concat(i.data)}}else{if(k.checked){j.selectedItems.push(k.data)}else{j.selectedItems.splice(j.selectedItems.indexOf(k.data),1)}}})},open:function(){var i=this;c.open({type:1,content:$("#"+i.popupWrapperId),title:"请选择",area:["auto","auto"]})},convertServerDataToClientTreeSource:function(k,j){if(!k){h.error("tree数据源为空!");return[]}var i=[];k.map(function(l){k.map(function(n){if(l[j.id]===n[j.parentId]){var m=l.children||[];m.push(n);l.children=m}});if(l[j.parentId]===j.topId){i.push(l)}});return i},};var e=function(i){return new f(i)};b("cfTreeTablePopup",e)});
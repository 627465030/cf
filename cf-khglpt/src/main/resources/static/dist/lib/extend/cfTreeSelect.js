layui.define(["tree","cfCustomTree"],function(b){var d=layui.$,h=layui.hint(),a=layui.tree,f=layui.cfCustomTree,g=d(document),c=function(i){var j=this;j.config=d.extend({},j.config,i);j.init(i.cfCustomTree);return j};c.prototype={config:{elem:"",placeholder:"",data:[],expandLevel:"",cfCustomTree:null,treeField:{id:"id",parentId:"pid",name:"name",topId:"0"},onSelectChange:function(i){}},render:function(){var k=this,j=k.config;var i="tree_input_"+j.elem.substring(1,j.elem.length);k.wrapper=k.elem.html('<div class="layui-unselect layui-form-select"></div>').children();k.titleWrapper=k.wrapper.html('<div class="layui-select-title"></div>').children();k.inputElem=k.titleWrapper.html('<input id="'+i+'" type="text" placeholder="'+j.placeholder+'" value="" class="layui-input layui-unselect">').children();k.titleWrapper.append('<i class="layui-edge"></i>');k.treeId="tree_"+j.elem.substring(1,j.elem.length);k.treeWrapper=k.wrapper.append('<div class="cf-option-wrapper layui-hide" style=""><div style="display: flex; justify-content: space-between; border-bottom: 1px solid #d2d2d2;"><div class="cf-tree-select-clear search">搜索</div><i class="layui-icon cf-tree-select-clear layui-anim-rotate layui-anim-loop loading" style="color: #1E9FFF;">&#xe63d;</i> <div class="cf-tree-select-clear clear">清除</div></div><ul id="'+k.treeId+'"></ul></div>').children(".cf-option-wrapper");k.titleWrapper.on("click",function(l){k.wrapper.addClass("layui-form-selected");k.treeWrapper.removeClass("layui-hide");if(!k.renderTreeSuccess){k.renderTree()}});k.inputElem.focus(function(l){k.wrapper.addClass("layui-form-selected");k.treeWrapper.removeClass("layui-hide")});d(document).bind("click",function(m){var m=m||window.event;var l=m.target||m.srcElement;while(l){if(l.id&&l.id===i){return}l=l.parentNode}k.treeWrapper.addClass("layui-hide");k.wrapper.removeClass("layui-form-selected")});return k},renderTree:function(){var k=this,j=k.config;var i=f||j.cfCustomTree||a;var l=i({elem:"#"+k.treeId,nodes:k.convertServerDataToClientTreeSource(JSON.parse(JSON.stringify(j.data)),j.treeField),defaultValue:k.value,click:function(m){k.inputElem.val(m[j.treeField.name]);k.treeWrapper.toggleClass("layui-hide");k.wrapper.toggleClass("layui-form-selected");j.onSelectChange(m)}});d("#"+k.treeId).parent().children().children(".clear").on("click",function(m){k.inputElem.val("");k.treeWrapper.toggleClass("layui-hide");k.wrapper.toggleClass("layui-form-selected");l.removeSelectedStyle();j.onSelectChange({})});d("#"+k.treeId).parent().children().children(".search").on("click",function(m){m.stopPropagation();l.changeSearchKey(k.inputElem.val())});d("#"+k.treeId).parent().children().children(".loading").addClass("layui-hide");k.renderTreeSuccess=true},setValue:function(k){var j=this,i=j.config;d("#"+j.treeId).parent().children().children(".loading").removeClass("layui-hide");j.renderTreeSuccess=false;j.inputElem.val(k[i.treeField.name]);j.value=k[i.treeField.id];d("#"+j.treeId).html("")},convertServerDataToClientTreeSource:function(l,j){var m=this,k=m.config;if(!l){h.error("tree数据源为空!");return[]}var i=[];l.map(function(n){n.spread=k.expandLevel=="all";n.name=n[j.name];n.id=n[j.id];l.map(function(p){if(n[j.id]===p[j.parentId]){var o=n.children||[];o.push(p);n.children=o}});if(n[j.parentId]===j.topId){n.spread=k.expandLevel=="all"||k.expandLevel==1;i.push(n)}});return i},init:function(){var j=this,i=j.config;if(!i.elem){h.error("元素为空!");return}j.elem=d(i.elem);j.render()}};var e=function(i){return new c(i)};b("cfTreeSelect",e)});